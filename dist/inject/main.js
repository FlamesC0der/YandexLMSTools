async function getAllLessons(e,t){return new Promise(function(a,n){fetch(`https://lms.yandex.ru/api/student/lessons?courseId=${e}&groupId=${t}`).then(e=>e.json()).then(e=>{a(e)})})}async function getLessonTasks(e,t,a){return new Promise(function(n,o){fetch(`https://lms.yandex.ru/api/student/lessonTasks?courseId=${e}&lessonId=${a}&groupId=${t}`).then(e=>e.json()).then(e=>{n(e)})})}async function getSetting(e){return new Promise(function(t,a){chrome.storage.sync.get(e,function(e){t(e)})})}async function setSetting(e,t){return new Promise(function(a,n){(settingData={})[e]=t,chrome.storage.sync.set(settingData,function(){a(!0)})})}function waitForElementToExist(e){return new Promise(t=>{if(document.querySelector(e))return t(document.querySelector(e));let a=new MutationObserver(()=>{document.querySelector(e)&&(t(document.querySelector(e)),a.disconnect())});a.observe(document.body,{subtree:!0,childList:!0})})}function round_str(e){return e.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]}function getURLData(){return(url=window.location.href).split("/")}console.log("YandexLMSTools by FlamesCoder");const RatingValues={classwork:{max:10,count:40},homework:{max:10,count:40},additional:{max:40,count:45},"control-work":{max:40,count:3},"individual-work":{max:20,count:4}};function YLMTheme(e){let t=document.createElement("style");t.media="screen",t.classList.add("yandexlmstools-theme"),t.textContent=".yandexlmstools-rating{display:inline-block;margin-left:15px;border:2px solid #fc0;border-radius:5px;padding:0 10px;max-width:200px}",document.head.appendChild(t)}function DarkTheme(e){if(e){let t=document.createElement("style");t.media="screen",t.classList.add("yandexlmstools-dark"),t.textContent='body,html{color:#fff;background:#1c1e1f!important}*{color:#fff!important}.icon_type_search{background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxmaWx0ZXIgaWQ9ImRhcmtyZWFkZXItaW1hZ2UtZmlsdGVyIj48ZmVDb2xvck1hdHJpeCB0eXBlPSJtYXRyaXgiIHZhbHVlcz0iMC4yODYgLTAuNzA2IC0wLjc3MiAwLjAwMCAxLjE5MCAtMC43NDIgMC4zMzEgLTAuNzYzIDAuMDAwIDEuMTczIC0wLjczMSAtMC43MDEgMC4yODggMC4wMDAgMS4xNDMgMC4wMDAgMC4wMDAgMC4wMDAgMS4wMDAgMC4wMDAiIC8+PC9maWx0ZXI+PC9kZWZzPjxpbWFnZSB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIGZpbHRlcj0idXJsKCNkYXJrcmVhZGVyLWltYWdlLWZpbHRlcikiIHhsaW5rOmhyZWY9ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQ0FBQUFBZ0NBWUFBQUJ6ZW5yMEFBQUFDWEJJV1hNQUFBc1RBQUFMRXdFQW1wd1lBQUFCZDBsRVFWUjRuTzJXWDBvQ1lSVEZmeWo2a3ZWcXRJUnNEOVVHc2lLc0hVUm1aUzBpd21YMHg5YVRSWllwdElCZUloL3lSZVBDR2ZnUXl1YjdwcEhBQXhkbW1PK2NlK2ZlTzRlQkdmNHg4a0FGYUFKUFFGOWgxemQ2Wm1mK0JOdEFEeGhOaUM2d2xXVGlETkJ3RXR3Qng4QXlNS2NvQVNkQXl6bDNJVzR3R2hMOEJQWW5pTnF6QTUyTmlnaHUrMGlDcXpGNGEwNFJtNzdKODg3TTdjM2pvaXJ1QzVEekthRGl6TnhubGxuZ1hobzdQZ1hjaW55RVArclN1UFloUDR0czIrNkxralRNSjJMalErUkNRQUh6MGpDdDJPZ25VTUNDTk41OXlMMEVSckFTTW9LbXlPWnd2amlUeHFVUGVVL2tWc0JuK0JEeUdlYUFWd21ZdmNaRlRkeU9yeEVaeW80Vm03MytGdXZBQUJnQ0d3UmdFWGh6aXFpcXRkOGhxemNmaUhNZW1yd3RvYWlJa2V5MUxwTXBLR3piVDUyWkQ1VThrMFR5dHU3THprNzhGSjBrMnQ0ZVN4N0JsbWxYdjE5ZG1aVzUzQ053cFczM1hqaEQwV21qbWNjU0thSTRTODRVMnU0NjF2akNwWXJEYVNhZmdiVHhCZTBZaHBRNTAvSkVBQUFBQUVsRlRrU3VRbUNDIiAvPjwvc3ZnPg==)}.icon_type_signal-outline.icon_size_l{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxmaWx0ZXIgaWQ9ImRhcmtyZWFkZXItaW1hZ2UtZmlsdGVyIj48ZmVDb2xvck1hdHJpeCB0eXBlPSJtYXRyaXgiIHZhbHVlcz0iMC4yODYgLTAuNzA2IC0wLjc3MiAwLjAwMCAxLjE5MCAtMC43NDIgMC4zMzEgLTAuNzYzIDAuMDAwIDEuMTczIC0wLjczMSAtMC43MDEgMC4yODggMC4wMDAgMS4xNDMgMC4wMDAgMC4wMDAgMC4wMDAgMS4wMDAgMC4wMDAiIC8+PC9maWx0ZXI+PC9kZWZzPjxpbWFnZSB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIGZpbHRlcj0idXJsKCNkYXJrcmVhZGVyLWltYWdlLWZpbHRlcikiIHhsaW5rOmhyZWY9ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQ0FBQUFBZ0NBWUFBQUJ6ZW5yMEFBQUFDWEJJV1hNQUFBc1RBQUFMRXdFQW1wd1lBQUFCRUVsRVFWUjRuTzNXc1VyRFVCVEc4WjhLVmNUUnpTZFFjQkVFc2FPTDRpczV1QlFkQkJVcStBamlPemo3QnU1YVN5ZWRSQVd4a2NBWmdvcWE5SnBTeUFjSFFyamYrZjczbmlTRVJoT3NYZHlqaDUxeEFQU1FSZDNWR2J5S1V3d0xBUG4xTVpiL00zZ1dYYndYZ2ovWEd3NHhrenA4RGxjUjhvSWpyS0dGZVd6Z1BBRHlOWmVZVGdsd0ZvMXZzZkxEdWpZZVl1MWV5cGtQOFJ6WHYya3J4dlNLcFJRQTNkalJTUW5QUlhqMlV3RGNSTFAxRXA3dDhGeW5BSGlLWmdzbFBJdmhlVXdCa0VXVjBWVGgrekFXZ0ZGOFg5UUFaTTBJTkEraDhiMkc3V2d5cU9BZGhIZXphbmlXdUNZUDRLL0hPOHFZS3FzZm9lMENRUDZMWHBzT3ZqbmlUcDBBcllEb3g4NDdjYS9SNU9rRE9zZVNSem5kSWM0QUFBQUFTVVZPUks1Q1lJST0iIC8+PC9zdmc+")}.notification-center{background:#1c1e1f!important}.notification-center__item_theme_light{border-color:#afa494!important}.Accordion,.course-card{border:1px solid #3f4547}.lesson-card:not(.lesson-card_narrow) .lesson-card__percentage_non-zero,.solution-status_type_accepted .solution-status__text{color:#71f871!important}.lesson-card__deadline,.lesson-card__full-caption,.lesson-card__lesson-info,.lesson-card__percentage,.lesson-card__progress{color:#afa494!important}.link-list__item{border:1px solid #3f4547!important}.progress-bar_theme_light{background-color:#232526!important}.nav-tab_back{background:#1c1e1f}.solution-status_type_rework .solution-status__text{color:#ff3030!important}.solution-status_type_review{background:#ffeba02e}.Accordion-Item{border-top:1px solid #3f4547}.Accordion-Group:not(:last-of-type) .Accordion-Item:last-of-type{border-bottom-color:#3f4547}.superscript-icon{background:#bc00ff8c}.Sideblock-Content{background:#232526!important}',document.head.appendChild(t)}else{let a=document.querySelector(".yandexlmstools-dark");a.parentNode.removeChild(a)}}function RemoveBanner(){try{let e=document.querySelector(".course-banners");if(e)try{e.parentNode.removeChild(e)}catch{console.log("Failed to remove banner")}}catch{console.log("Failed to remove banner")}}async function CalcTaskRating(e){url=getURLData();let t=document.querySelectorAll(".yandexlmstools-rating");if(e){if(url.includes("tasks")){let a=await waitForElementToExist(".y43a24--task-info"),n=document.createElement("div");n.classList.add("yandexlmstools-rating");let o=document.createElement("span");o.classList.add("yandexlmstools-rating__value");let s=document.createElement("span");s.textContent="Possible rating: ",n.appendChild(s);let l=await getLessonTasks(url[4],url[6],url[8]),r={},d=null;l.forEach(e=>{e.tasks.forEach(e=>{type=e.tag.type,score=e.scoreMax,e.id==url[10]&&(d=e),r[type]=(r[type]||0)+1})}),type=d.tag.type,o.textContent=round_str(RatingValues[type].max/RatingValues[type].count/100*d.scoreMax),n.appendChild(o),a.appendChild(n)}else if(url.includes("lessons")){let i=await waitForElementToExist(".student-lesson-progress__counts"),c=document.createElement("div");c.classList.add("yandexlmstools-rating");let m=document.createElement("span");m.classList.add("yandexlmstools-rating__value");let g=document.createElement("span");g.textContent="Possible rating: ",c.appendChild(g);let u=await getLessonTasks(url[4],url[6],url[8]),h={};u.forEach(e=>{e.tasks.forEach(e=>{type=e.tag.type,score=e.scoreMax,h[type]=(h[type]||0)+1})});let M=0;Object.entries(h).forEach(e=>{M+=RatingValues[e[0]].max/RatingValues[e[0]].count}),m.textContent=round_str(M),c.appendChild(m),i.appendChild(c)}}else try{t.forEach(e=>{e.parentNode.removeChild(e)})}catch{console.log("Failed to remove Rating block")}}async function PageLoad(){url=getURLData(),console.log(url),await setSetting("courseId",url[4]),YLMTheme();(await getSetting("setting-dark"))["setting-dark"]&&DarkTheme(!0);(await getSetting("setting-banner"))["setting-banner"]&&RemoveBanner();(await getSetting("setting-task-score"))["setting-task-score"]&&CalcTaskRating(!0)}chrome.runtime.onMessage.addListener(function(e,t,a){"changedURL"==e.message&&(console.log(e.url),PageLoad()),"storageUpdate"==e.message&&("setting-dark"==e.data.key?DarkTheme(e.data.value):"setting-banner"==e.data.key?RemoveBanner():"setting-task-score"==e.data.key&&CalcTaskRating(e.data.value))}),window.addEventListener("DOMContentLoaded",function(){PageLoad()});